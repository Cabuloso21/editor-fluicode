<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Recebe e Edita Dados</title>
<style>
  #recebe-dados-container div { border:1px solid #ccc; padding:8px; margin:5px 0; }
  button { margin-right:5px; margin-top:5px; }
  input { display:block; margin:2px 0; padding:4px; width:95%; }
</style>
</head>
<body>
  <a href="interface.html">Anunciar</a>
    </div>
        
    </div>
  
  
  
  <h2>Dados Recebidos</h2>
<div id="recebe-dados-container"></div>
<div id="mensagem-recebe-dados"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getFirestore, collection, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCWH18dhHz0EBY5Ycc4wjZ1H6AlO-51sho",
  authDomain: "teste1-66092.firebaseapp.com",
  projectId: "teste1-66092",
  storageBucket: "teste1-66092.appspot.com",
  messagingSenderId: "517435649522",
  appId: "1:517435649522:web:a6826c13b1e2c5062acf6b",
  measurementId: "G-3GVBBV8W7C"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const container = document.getElementById('recebe-dados-container');
const mensagemDiv = document.getElementById('mensagem-recebe-dados');

const camposOrdem = ['Nome','Cpf','Valor R$','Whatsapp','Cidade','Endereço','Descrição'];

async function carregarDados() {
  container.innerHTML = '';
  const snapshot = await getDocs(collection(db,'anuncios'));
  const docsArray = snapshot.docs.reverse();

  docsArray.forEach(docSnap => {
    const data = docSnap.data();
    const div = document.createElement('div');

    const inputsMap = {};
    camposOrdem.forEach(k => {
      if(data[k]!==undefined){
        const p = document.createElement('p');
        p.textContent=`${k}: ${data[k]}`;
        inputsMap[k]=p;
        div.appendChild(p);
      }
    });

    const btnExcluir = document.createElement('button');
    btnExcluir.textContent='Excluir';
    btnExcluir.addEventListener('click', async ()=>{
      await deleteDoc(doc(db,'anuncios',docSnap.id));
      carregarDados();
    });

    const btnEditar = document.createElement('button');
    btnEditar.textContent='Editar';
    btnEditar.addEventListener('click', ()=>{
      div.innerHTML='';
      const inputs = {};
      camposOrdem.forEach(k=>{
        const label=document.createElement('label'); label.textContent=k;
        const input=document.createElement('input'); input.value=data[k]||''; inputs[k]=input;
        div.appendChild(label); div.appendChild(input);
      });
      const btnSalvar=document.createElement('button');
      btnSalvar.textContent='Salvar';
      btnSalvar.addEventListener('click', async ()=>{
        const updatedData={};
        camposOrdem.forEach(k=>updatedData[k]=inputs[k].value);
        try{
          await updateDoc(doc(db,'anuncios',docSnap.id),updatedData);
          mensagemDiv.style.color='green'; mensagemDiv.textContent='✅ Dados salvos com sucesso.';
          carregarDados();
        }catch(err){
          mensagemDiv.style.color='red'; mensagemDiv.textContent='Erro ao salvar: '+err.message;
        }
      });
      div.appendChild(btnSalvar);
    });

    div.appendChild(btnEditar);
    div.appendChild(btnExcluir);
    container.appendChild(div);
  });
}

carregarDados();
</script>
</body>
</html>
