<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GERA INTERFACE</title>
</head>
<body>
  <h1>GERA INTERFACE</h1>

          <!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Interface Lopixecodin - Link Personalizado</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
  .pagment { border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 8px; background: #f8f8f8; }
  a.btn {
    display: inline-block;
    padding: 8px 12px;
    background: #007bff;
    color: #fff;
    text-decoration: none;
    border-radius: 5px;
    margin-top: 5px;
  }
</style>
</head>
<body>

<h1>Interface do Código Salvo</h1>
<div id="container">Carregando...</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCWH18dhHz0EBY5cc4wjZ1H6AlO-51sho",
    authDomain: "teste1-66092.firebaseapp.com",
    projectId: "teste1-66092",
    storageBucket: "teste1-66092.firebasestorage.app",
    messagingSenderId: "517435649522",
    appId: "1:517435649522:web:a6826c13b1e2c5062acf6b",
    measurementId: "G-3GVBBV8W7C"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const container = document.getElementById("container");

  const pagmentBlockRegex = /\[pagment\]([\s\S]*?)\[pagment\]/gi;
  const funcBlockRegex = /\[função\]([\s\S]*?)\[função\]/gi;
  const fieldRegex = /^\[:([\p{L}\p{N}_-]+):\s*(.*?)\s*\]$/u;
  const funcButtonRegex = /^\[botão:\s*([^:]+): direct link:(https?:\/\/[^\]\s]+)\]$/iu;

  function getParametroURL(nome) {
    const url = new URL(window.location.href);
    return url.searchParams.get(nome);
  }

  function renderizarInterface(codigo) {
    container.innerHTML = "";
    const pagments = [...codigo.matchAll(pagmentBlockRegex)];

    pagments.forEach((match, i) => {
      const pagmentText = match[1];
      const campos = pagmentText.split('\n').map(l => l.trim()).filter(l => l.length);

      const pagmentDiv = document.createElement("div");
      pagmentDiv.className = "pagment";

      campos.forEach(linha => {
        const m = linha.match(fieldRegex);
        if (m) {
          const campoEl = document.createElement("p");
          campoEl.innerHTML = `<strong>${m[1]}:</strong> ${m[2]}`;
          pagmentDiv.appendChild(campoEl);
        }
      });

      const funcMatches = [...codigo.matchAll(funcBlockRegex)];
      if (funcMatches.length > i) {
        const funcText = funcMatches[i][1];
        const funcLines = funcText.split('\n').map(l => l.trim()).filter(l => l.length);

        funcLines.forEach(fl => {
          const btnMatch = fl.match(funcButtonRegex);
          if (btnMatch) {
            const nomeBotao = btnMatch[1];
            const link = btnMatch[2];
            const botao = document.createElement("a");
            botao.href = link;
            botao.target = "_blank";
            botao.textContent = nomeBotao;
            botao.className = "btn";
            pagmentDiv.appendChild(botao);
          }
        });
      }

      container.appendChild(pagmentDiv);
    });

    if (pagments.length === 0) {
      container.innerHTML = "<p>Nenhum bloco [pagment] encontrado.</p>";
    }
  }

  async function carregarCodigoPorSlug(slug) {
    try {
      const docRef = doc(db, "links", slug);
      const snap = await getDoc(docRef);
      if (!snap.exists()) {
        container.innerHTML = "<p>Link personalizado não encontrado.</p>";
        return;
      }
      const conteudo = snap.data().conteudo || "";
      renderizarInterface(conteudo);
    } catch (error) {
      container.innerHTML = "<p>Erro ao carregar: " + error.message + "</p>";
    }
  }

  const slug = getParametroURL("slug");
  if (slug) {
    carregarCodigoPorSlug(slug);
  } else {
    container.innerHTML = "<p>Link inválido. Nenhum slug fornecido.</p>";
  }
</script>

</body>
</html>
  
